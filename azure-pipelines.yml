# Nome da pipeline
name: Pipeline

# Pool de agentes (assumindo ambiente Ubuntu)
pool:
  vmImage: ubuntu-latest

# Gatilho: executa a pipeline em push para a branch 'main' e pull requests
trigger:
  branches:
    include:
      - main
pr:
    branches:
      include:
        - main

jobs:
  - job: BuildTest
    variables:
      DATABASE_URL: $(DATABASE_URL)
      SECRET_KEY: $(SECRET_KEY)
      ALGORITHM: $(ALGORITHM)
      ACCESS_TOKEN_EXPIRE_MINUTES: $(ACCESS_TOKEN_EXPIRE_MINUTES)

    # Checkout code
    steps:
      - checkout: self

      # Instalar Python
      - task: UsePythonVersion@0
        inputs:
          versionSpec: '3.11'
          architecture: 'x64'

      # Instalar Poetry
      - script: |
          curl -sSL https://install.python-poetry.org | python3 -

      # Instalar Dependências
      - script: poetry install

      # Formatar código (assuming poetry run task format exists)
      - script: poetry run task format

      # Executar testes
      - script: poetry run task test
